# 数据和文件概览

## 概括

`Android`中使用的不同数据的存储选项 :

* 内部文件存储 ： 在设备文件系统中存储应用私有文件
* 外部文件存储 :    在共享外部文件系统中存储文案。此方式通常用于共享文件，如图片.文档
* 共享首选项     :    在键值对中存储私有的原始数据
* 数据库             :     在私有数据库中存储结构化数据

> 除了外部存储的某些文件类型外，所有的这些选项都适用于应用私有数据(即其它应用无法自然访问的数据)。
>
> 如果希望共享文件,则使用，则应使用`FileProvider`API。
>
> 如果希望向其他应用公开应用数据，则可使用`ContentProvider`。借助内容提供程序，可以完全控制向其他应用提供哪些读取/访问权限，无论您为数据选择何种存储介质。

## 内部存储

默认情况下，保存至内部存储的文件是应用的私有文件，其他应用和用户是不能访问这些文件的(除非拥有`Root`权限)。

在文件系统中，系统会为每个应用提供私有目录，在该目录下整理应用所需的人和文件。

当用户卸载应用时，保存在内部存储中的文件也将随之消除，不应使用内部存储来保存用户希望独立于应用而保留的任何数据，例如，照片，视频，文档等文件。

### 内部缓存文件

如果你想暂时保留而非永久存储某些数据，则应使用特殊的缓存的目录来保存这些数据。针对这些类型的数据，每个应用都有专门的私有缓存目录。当设备的内部存储空间不足时，`Andorid`可能会删除这些缓存文件以回收空间。但是，不应该依赖系统为您清理这些文件，而应该自行维护换文件，使其占用的空间保持在合理的限制范围内(例如 1MB ).`当用户卸载应用时，缓存文件也会随之移除`。

## 外部存储

每个`Android`设备都支持共享的`外部存储`空间，您可以使用该空间存储文件。称其为外部空间的原因时，用户并非始终都能访问该空间。用户可以外部存储设备的形式，将此存储空间安装到计算机中，甚至将其随身携带(如 SD 卡)。保存至外部存储的文件是全局可读取文件，而且当在计算机上启用`USB`大容量存储来传输文件时，用户可以对这些文件进行修改。

> 外部存储空间并不一定一直在手机中，也可能是`SD卡`。因此，在尝试访问应用外部存储中的文件时，应检查外部存储目录及尝试访问的文件是否可用。

通常，用户拍摄的照片或下载的文件不希望在卸载应用后被移除，则可以考虑使用外部存储，针对这些类型的文件，系统为其提供了标准的公共目录(如`DCIM`,`Pictures`等目录)，用户只需一个位置就可保存该目录下的所有照片、铃声、音乐等数据。



开发者也可将文件保存至应用特定目录的外部存储中，当用户卸载应用时，系统也会删除该目录(例如：`/sdcard/Android/data/包名/`)。如果应用需要更多的存储空间，外部存储空间是一个替代选项，但用户并非始终能够访问此空间中的文件，此空间的文件面临着更改，删除等风险。

## 共享首选项

如果无需存储大量数据和存储结构，则应该使用`SharedPreferences`。借助`SharedPreferences`API，可以读取和写入原始数据类型(布尔型，浮点型，整数型，长整型和字符串类型)的`永久键值对`。



系统会将键值对写入`XML`文件，这类文件会永久保存在用户会话中（即便系统终止应用）。文件可手动指定，也可以使用每个`Activity`的文件来保存数据。



API 名称“共享首选项”有一定的误导性，因为此 API 并不严格用于保存“用户首选项”，例如用户选择的铃声。您可以使用 `SharedPreferences` 来保存任何类型的简单数据，例如用户的高分。

## 数据库

`Android`提供了对`SQLite`数据库的完整支持。开发者创建的数据库只有开发者才可以访问。`Google`建议使用`Room 持久存储库`(而非直接使用`SQLite API`)创建数据库并与之交互。



Room 库提供对象映射的抽象层，可实现流畅的数据库访问，同时利用 SQLite 的全部功能。



尽管您仍可[使用 SQLite 直接保存数据](https://developer.android.google.cn/training/data-storage/sqlite)，但 SQLite API 的层级相当低，使用它时需花费大量时间和精力。例如：

* 原始 SQL 查询没有编译时验证。
* 随着模式的更改，您需手动更新受影响的 SQL 查询。此过程可能非常耗时且容易出错。
* 您需要编写大量样板文件代码，以便在 SQL 查询和 Java 数据对象之间进行转换。

在通过 SQLite 提供抽象层时，[Room 持久存储库](https://developer.android.google.cn/training/data-storage/room)可为您解决这些问题。



### 数据库调试

Android SDK 包含一项 `sqlite3` 数据库工具，利用此工具可以浏览表内容、运行 SQL 命令，以及在 SQLite 数据库上执行其他实用功能。如需了解详细信息，请参阅 [adb 文档](https://developer.android.google.cn/studio/command-line/adb#othershellcommands)。



## 其它

### Codelab

* [保持敏感数据的安全性和私密性](https://codelabs.developers.google.com/codelabs/android-storage-permissions/)

