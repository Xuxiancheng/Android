# 删除数据恢复

## 原理

当向硬盘里存放文件时，操作系统首先会在硬盘的文件分配表内写上文件名称、大小，并根据数据区的空闲空间在文件分配表上继续写上文件内容在数据区的起始位置，然后开始向数据区写上文件的真实内容，这样一个文件存放操作才算完毕。

而当删除文件时，其步骤却比建立文件要简单的多。执行删除操作后，系统只是在文件分配表内在该文件前面写一个删除标志，表示该文件已被删除，他所占用的空间已被“释放”，其他文件可以使用他占用的空间。所以，当删除文件又想找回它(数据恢复)时，只需用工具将删除标志去掉，数据就被恢复回来了。当然，恢复的前提是没有新的文件写入，该文件所占用的空间没有被新内容覆盖。

##  方法

### 物理拆解

物理拆解芯片进行数据恢复。通过拆解并取出存储芯片后，借助硬件工具读取芯片的数据后进行数据恢复。这种方法的优点在于不会对存储芯片写入新的数据，能够较好的保护数据的原始状态。缺点也显而易见，这种方法对工具和动手能力要求较高，稍有不慎手机和芯片都有报废风险，普通用户较难独立完成这类操作。

![](http://image.3001.net/images/20160128/14539153479536.jpg!small)

### PC工具恢复

借助安装在PC端的第三方工具进行数据恢复。目前网络上名气较大的安卓数据恢复工具主要有Wondershare Dr.Fone，Tenorshare-android-data-recovery，7-Data Recovery Suite 等软件，但这类软件普遍存在的问题是，常常无法与手机建立连接，或者在连接后扫描时提示失败，可能是由于安卓系列手机系统定制化程度较高，每家手机制造商都对安卓系统做了或多或少修改的缘故，导致实际效果并不理想。

### Android工具恢复

借助安装在手机上的安卓APP进行数据恢复。由于APP直接运行在手机上，因此不存在第二种方法中软件与手机连接失败的问题，这类软件恢复的效果好坏很大程度上取决于软件开发人员使用的数据恢复算法能力的优劣。这类软件有很多，以某数字清理大师为例，某数字清理大师的隐私粉碎功能能够扫描到用户之前删除的部分类型文件，并确实能够对这类文件进行恢复。但其缺点也有很多，主要有四点：

1. 能够恢复的文件类型有限，主要是针对照片、短信、通话记录等；

2. 照片时只能一张一张点开恢复，无法批量恢复，操作繁琐；

3. 数据恢复算法不够强，与传统数据恢复工具如R-Studio和EasyRecovery相比存在不小差距；

4. 数据只能恢复到手机内部存储空间中，无法选择恢复到SD卡，因此手机原数据存在被新恢复数据覆盖的风险。

当然，这些缺点可能与这款软件的定位是隐私粉碎而非隐私恢复相关，这些缺点在很多同类软件上也同样存在，特别是数据恢复能力方面很多软件在这方面功能实在是过于孱弱，第三种方法由于存在诸多弊端同样不能让人满意。

### 正确恢复安卓手机数据的姿势

第一步，对手机进行Root，Root前需要进入开发者模式并打开USB调试模式。这是最基本的要求，具体如何Root与手机的型号有关，如果实在不会就找身边的异性IT达人帮忙吧。

第二步，在手机中安装`BusyBox`。建议从Google官方下载，梯子自备，文章中用到的工具会在结尾处提供，懒人自取。BusyBox安装时可选择路径，假设安装在[`/system/bin/busybox`]。

第三步，将手机与电脑连接。连接后需要安装相应驱动，可借助豌豆荚等工具进行安装。另外需要准备好adb调试工具（adb.exe等文件），可从Android SDK官网下载，Root工具包中一般也会提供。

第四步，电脑中安装32位版本的Cygwin[C:\cygwin]，并下载nc.exe和pv.exe，将这两个文件和之前准备好的adb.exe，AdbWinUsbApi.dll，AdbWinUsbApi.dll复制到[`C:\cygwin\bin\`]目录下。

第五步，运行[`C:\cygwin\Cygwin.bat`]，依次输入下图中的命令，输入后窗口保持打开不要关闭：

![](http://image.3001.net/images/20160128/14539163543561.png!small)

``` shell
adb forward tcp:5555 tcp:5555
adb shell
su
/system/bin/busybox nc -l -p 5555 -e /system/bin/busybox dd if=/dev/block/mmcblk0
```

第六步，再运行一次[`C:\cygwin\Cygwin.bat`]打开另一个窗口，依次输入如下命令：

``` shell
adb forward tcp:5555 tcp:5555
cd /
nc 127.0.0.1 5555 | pv -i 0.5 > mmcblk0.raw
```

这时窗口上应该会出现如图所示的进度

![](http://image.3001.net/images/20160128/14539164172963.png!small)

耐心等待完成后，[`C:\cygwin`]目录下会出现mmcblk0.raw文件，文件大小等于手机内部存储空间的大小，该文件正是手机内部存储空间的镜像文件。

第七步，打开一款传统的数据恢复工具，由于raw文件是linux文件系统格式，因此需要支持这类系统的软件，经过实际使用测试发现，R-Studio和Easy Recovery均能较好识别这类文件格式，笔者更偏爱R-Studio，因此以这款软件为例。加载刚刚生成的mmcblk0.raw镜像，如图所示。

![](http://image.3001.net/images/20160128/14539164783836.png!small)

对镜像中的userdata部分进行扫描，扫描后即可找到被误删除的各类数据。

![](http://image.3001.net/images/20160128/14539164965058.png!small)

### 资料来源

[https://forum.xda-developers.com/galaxy-nexus/general/guide-internal-memory-data-recovery-yes-t1994705](https://forum.xda-developers.com/galaxy-nexus/general/guide-internal-memory-data-recovery-yes-t1994705)

